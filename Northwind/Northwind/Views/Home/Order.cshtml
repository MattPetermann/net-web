@using Northwind.Models
@{
	ViewBag.Title = "Order";
}

<table class="table table-bordered table-hover">
	<thead>
	<th style="width:70%">Product Name</th>
	<th style="width:10%" class="right-align">Unit</th>
	<th style="width:10%" class="right-align">Quantity</th>
	<th style="width:10%" class="right-align">Total</th>
	</thead>
	<tbody>
		@foreach (Product p in Inventory.GetInventory())
		{
			<tr>
				<td>@p.Name</td>
				<td class="right-align">$@p.Price.ToString("#,###.00")</td>
				<td class="right-align">
					<input type="number" class="form-control form-control-sm edit" value=0 min=0 step=1 data-item=@p.Id data-edit="#row_@p.Id" />
				</td>
				<th class="right-align">$<span id="row_@p.Id" class="row-total" data-value="0">0.00</span></th>
			</tr>
		}
		<tr>
			<th class="right-align">Total:</th>
			<th></th>
			<th></th>
			<th class="right-align">$<span id="col-total">0.00</span></th>
		</tr>
	</tbody>
</table>

<button class="btn btn-primary" id="checkout" data-toggle="modal" data-target="#personalInfo">
	<span class="fa fa-shopping-cart"></span> Checkout
</button>

<div class="modal fade" id="personalInfo">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h4 class="modal-title">Modal Heading</h4>
				<button type="button" class="close" data-dismiss="modal">&times;</button>
			</div>
			<div class="modal-body">
				Modal body..
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
			</div>
		</div>
	</div>
</div>

@section scripts {
	<script>
		$(function(){
			$('.edit').on('change', function(){
				if($(this).val() < 0)
					$(this).val(0);
				if($(this).val() % 1 != 0)
					$(this).val(Math.round($(this).val()));

				var rowTotal = ($(this).val() * findInInventory($(this).data('item'))).toFixed(2);
				$($(this).data('edit')).text(rowTotal);
				$($(this).data('edit')).data('value', rowTotal);

				var colTotal = 0;
				$('.row-total').each(function() {
					colTotal += parseFloat($(this).data('value'));
				})

				$('#col-total').text(colTotal.toFixed(2));
			});
		});

		function findInInventory(id) {
			var raw = "@Inventory.GetIdList()";
			var json = JSON.parse(raw.replace(/&quot;/g, "\""));
			var ret = -1;
			json.arr.forEach(function(item){
				if(item.id == id)
					ret = item.price;
			});
			return ret;
		}
	</script>
}